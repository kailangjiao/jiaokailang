C51 COMPILER V9.01   DS18B20                                                               08/18/2019 16:56:41 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN DS18B20.OBJ
COMPILER INVOKED BY: D:\C51\BIN\C51.EXE DS18B20.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"ds18b20.h"
   2          
   3          void delay1ms(u16 y)
   4          {
   5   1          u8 x;
   6   1              for(;y>0;y--)
   7   1              {
   8   2                  for(x=110;x>0;x--);
   9   2      
  10   2              }
  11   1      
  12   1      }
  13          
  14          u8 ds18b20init()
  15          {
  16   1          u8 i;
  17   1              dsport=0;
  18   1          i=70;
  19   1              while(i--);
  20   1              i=0;
  21   1              dsport=1;
  22   1              while(dsport)
  23   1              {
  24   2                  delay1ms(1);
  25   2                      i++;
  26   2                      if(i>5)
  27   2                      {
  28   3                          return 0;
  29   3                      }
  30   2              }
  31   1              return 1;
  32   1      }
  33          
  34          void ds18b20writebyte(u8 dat)
  35          {
  36   1              u8 i,j;
  37   1          
  38   1               for(j=0;j<8;j++)
  39   1               {
  40   2                        dsport=0;
  41   2                    i=3;
  42   2                        while(i--);
  43   2                        dsport=dat&0x01;
  44   2                        i=6;
  45   2                        while(i--);
  46   2                        dsport=1;
  47   2                        dat>>=1;      
  48   2               }
  49   1      }
  50          
  51          u8 ds18b20readbyte()
  52          {
  53   1          u8 i,j;
  54   1              u8 bi, byte;
  55   1              for     (i=0;i<8;i++)
C51 COMPILER V9.01   DS18B20                                                               08/18/2019 16:56:41 PAGE 2   

  56   1              {
  57   2                  dsport=0;
  58   2                      j++;
  59   2                      dsport=1;
  60   2                      j++;
  61   2                      j++;
  62   2                      bi=dsport;
  63   2                      byte=((byte>>1)|(bi<<7));
  64   2                      j=6;
  65   2                      while(j--);
  66   2              }
  67   1              return byte;
  68   1      }
  69          
  70          void ds18b20changetemp()
  71          {
  72   1               ds18b20init();
  73   1               delay1ms(1);
  74   1               ds18b20writebyte(0xcc);
  75   1               ds18b20writebyte(0x44);
  76   1      }
  77          
  78          void ds18b20readchangetemp()
  79          {
  80   1               ds18b20init();
  81   1               delay1ms(1);
  82   1               ds18b20writebyte(0xcc);
  83   1               ds18b20writebyte(0xbe);
  84   1      }
  85          
  86          u16 ds18b20readtemp()
  87          {       
  88   1              u8 thl,thh;
  89   1              u16 temp;       
  90   1               ds18b20changetemp();
  91   1               ds18b20readchangetemp();
  92   1               thl=ds18b20readbyte();
  93   1               thh=ds18b20readbyte();
  94   1               temp=thh;
  95   1               temp<<=8;
  96   1               temp|=thl;
  97   1               return temp;
  98   1      }
  99          
 100          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    177    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
